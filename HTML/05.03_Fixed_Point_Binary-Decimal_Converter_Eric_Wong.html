<!DOCTYPE html>
<html>
	<head>
		<style>
			table,
			th,
			td {
				padding: 5px;
				border: 1px solid #000000;
				border-collapse: collapse;
				text-align:center;
				table-layout: fixed;
				width: 20%;
      			}
			
			input {text-align: center;}
    		</style>
	</head>
	<body>
		<h1>05.03 Fixed Point Binary <-> Decimal Converter Eric Wong</h1>
		
		<p>Binary Number:</p>
		<table id = "tblBits">
  			<tr>
				<td>-8</td>
				<td>4</td>
				<td>2</td>
				<td>1</td>
				<td rowspan="2"><sup style ="font-size: xx-large;"><b>.</b></td>
				<td>1/2</td>
				<td>1/4</td>
				<td>1/8</td>
				<td>1/16</td>
				
				<!-- 
					What is the decimal place value of the first bit? 
					Note that we show the bits from right -> left in increasing place value.
					
					Copy and paste the line above 7 times for each of the 8 bits and change the decimal place value.
				-->

				<!-- Explaination:
					The decimal place value of the first bit from left to right is -8. It is intended to represent 8,
					but in a complement (signed) binary, the first bit is multiplied by -1 (which turns into -8), in
					order to represent negative decimal numbers.

					However, the first decimal plae value of the first bit from right to left is 0.0625, which is 1/16,
					and it doubles as we go to the left.
					
					We have to paste it 7 more times because we need 8 bits to represent from -8 to 7.9375
				-->
			</tr>
			<tr>
				<td><input type = "button" id = "btn-8" onclick = "convDec(this.id)" value = "0"></td>
				<td><input type = "button" id = "btn4" onclick = "convDec(this.id)" value = "0"></td>
				<td><input type = "button" id = "btn2" onclick = "convDec(this.id)" value = "0"></td>
				<td><input type = "button" id = "btn1" onclick = "convDec(this.id)" value = "0"></td>
				<td><input type = "button" id = "btn0.5" onclick = "convDec(this.id)" value = "0"></td>
				<td><input type = "button" id = "btn0.25" onclick = "convDec(this.id)" value = "0"></td>
				<td><input type = "button" id = "btn0.125" onclick = "convDec(this.id)" value = "0"></td>
				<td><input type = "button" id = "btn0.0625" onclick = "convDec(this.id)" value = "0"></td>
				
				<!-- Copy and paste the line above 7 times for each of the 8 bits and change the id (decimal place value). -->
				
				<!-- Explaination:
					We also have to paste this 7 more times since there are 8 bits that we need to represent.
				-->
			</tr>
		</table>
		<h3>Number In Decimal:</h3>
		<input type = "number" id = "inpDecNum" min = -8 max = 7.9375 value = "0">
		<input type = "button" onclick = "convBin()" id = "btnToBin" value = "Convert to Binary">
		
		<script>
			function convDec(btn) {
				
				/*
					How do we know the id of the button that has been clicked so we can 
					switch it from 0 -> 1 or 1 -> 0?
					(See the name of variable passed to this function inside (...) of the 
					function header above.)
				*/

				/* Explaination:
					We can get the button that is clicked by getting the button by its id, which is
					passed into the "btn" parameter in the convDec function when it was called with
					convDec(this.id) in the button's onclick function.
				*/

				let btnClicked = document.getElementById(btn);
				
				/* 
					We only switch a bit if a button was clicked,
					i.e. If an invalid decimal was entered then we need to return
					the decimal number to whatever the button bits currently represent
					but don't switch any bits. 
				*/

				if (btnClicked != null)
					
					// If the value of the button is 0 switch it to a 1 else a 0.

					/* Explaination:
						If the value of the button is 0, we have to switch it to a 1
						otherwise, the value of the button must be 1, so we have to
						switch it to 0.

						Therefore, we can toggle the button's value between 1 and 0.
					*/
					
					if (btnClicked.value == 0)
						btnClicked.value = 1;
					else
						btnClicked.value = 0;
				
				
				// What is the id of the table with all the "binary bit" buttons?
				/*
					The id of the table with all the "binary bit" buttons is "tblBits" (line 23). However,
					there are in total of 9 inputs in the whole HTML document, so in order to distunguish
					between the bits buttons and the "Submit" button, we have to get all the inputs
					in the "tblBits" element, which only contains the bits buttons.
				*/

				let bits = document.getElementById("tblBits").getElementsByTagName('input');
				
				/* 
					The variable below will hold the decimal equivalent of the bits in the table.
					What should it be initialised to?
				*/

				/* Explaination:
					The variable should be initlized to 0, because we have to start with -8
					for the conversion as there are no numbers being converted since the start.
					Also it is the variable that holds the decimal number value, so it should 
					be initlized to 0.
				*/
				let decNum = 0;
				
				/* 
					The variable below will hold the decimal place value of each bit.
					What is the decimal place value of the first bit?
					Note that we go through all the bits from left -> right.
				*/

				/* Explaination:
					The first decimal place value of the first bit is -8, since we are going from
					left to right. When we are going from left to right, the first bit is 2^4, which
					is 8, and this converter is also used for complement (signed) binary, we have to
					make it a -8, since we also need to represent negative decimal numbers.
				*/

				// STOPPED HERE LAST TIME: CRITERIA 13

				let placeVal = -8
				
				for (let b of bits) {
					
					/* 
						Which variable holds the decimal equivalent of the bits in the table?
						Which variable holds the place value of each bit to multiply by?
					*/

					/* Explaination:
						The "decNum" variable holds the decimal equivalent of the bits in the table, so we have to
						add each binary place value to it each time we iterate through a bit.

						The "placeVal" variable holds the binary place value in each bit, but we have to multiply
						it by "b.value" since "b.value" represents whether there is a value on this bit or not (0 or 1).
						If its a 0 we basically add nothing, but if it is 1, we add the placeVal.
					*/
					decNum += b.value * placeVal;
					
					// Which variable needs halving for each "bit"?

					/* Explaination:
						The placeVal variable needs to be halved each time we go through a bit, because the binary
						place value halves as we go through each bit from left to right. For example, the second bit
						is 2^3, which is 4, but the next bit is 2^2, which is 4. This shows we have to half the 
						placeVal variable each time we go through a bit.

						Additionally, in a complement (signed) binary, the first bit is -8, but the second is 4, so
						in order to change -8 to 4, we have to divide the placeVal by -2 to change it to a positive number,
						only if placeVal was the first bit (or a negative number).s 
					*/

					if (placeVal < 0) 
						placeVal /= -2
					else
						placeVal /= 2
				}
				
				/* 
					What is the id of the input box which shows the decimal equivalent of the bits in the table?
					Which variable needs to be displayed there?
				*/

				/* Explaination:
					The id of the input box is called inpDecNum (as in line 66), and we have to put the decimal result,
					which is called "decNum" in the value of the input box (.value = decNum).
				*/

				document.getElementById("inpDecNum").value = decNum;
				
			}
			
			function convBin() {
				
				// What is the id of the input box which holds the decimal number to convert to binary?
				// Explaination: The input box that holds the decimal number that we are converting is called inpDecNum (line 71).

				let decNum = document.getElementById("inpDecNum").valueAsNumber;
				
				// What is the lowest decimal number that can be represented by 8 bits in this converter?

				/* Explaination:
					The lowest decimal number that can be represented by this converter is when all the bits
					are "off" except for the first -8  bit, which in that case the equivalent decimal number 
					is -8. It is impossible for the converter to produce any lower decimal number.
				*/

				if (decNum < -8) {
					alert("This converter does not deal with numbers < -8 !");
					convDec(); // Call the convDec() function to reconvert what the bits show.
				}
				
				// What is the highest decimal number that can be represented by 8 bits in this converter?

				/* Explaination:
					Highest decimal number that can be represented is 7.9375, as when all the bits are on (or 1) except 
					for the first -8 bit. When all the positive bits are on, the decimal value of the place value is
					4 + 2 + 1 + 0.5 + 0.25 + 0.125 + 0.0625, which is 7.9375. It is impossible for this converter to
					produce a higher decimal value than 7.9375
				*/

				else if (decNum > 7.9375) {
					alert("This converter does not deal with numbers > 7.9735 !");
					convDec(); // Convert the binary number currently showing to decimal.
				}
				
				else {
					// What is the id of the table with all the "binary bit" buttons?
					// Explaination: The id of the table with all the binary bits is called "tblBits" (line 23)

					let bits = document.getElementById("tblBits").getElementsByTagName('input');
					
					/* 
						The variable below will hold the place value of each bit.
						What should it be initialised to (note that we go through all the bits from
						left -> right).
					*/

					/* Explaination:
						We are going from left to right again in the binary place value, and we are also "ignoring"
						the first bit since it is a negative number, which means we are starting from the second bit
						from left to right. Therefore, placeVal should be initlized to 4 since its starting from the
						place value of the second bit from left to right.
					*/
					
					let placeVal = 4;

					if (decNum < 0) {

						/* Explaination:
							If the decNum is a negative number, the first bit of the binary value is always "on".
							Therefore, we can ignore the first bit, and basically convert the remaining bits.

							For example, if we entered -1, we can just simply put "on" the first bit, and we subtract
							-8 from the decNum, which is basically adding 8 to it. After that, the decNum becomes 7
							and we can just simply convert the bits after the -8 bit.
						*/

						decNum -= -8
						bits[0].value = 1;
					} else {
						bits[0].value = 0;
					}
					
					for (let i = 1; i < bits.length; i ++) {

						/* Explaination:
							We have to do a normal for loop this time, since we are ignoring the first bit (or button) from
							the bits array. Therefore, we have to start from 1, so this for loop would not operate with the
							first bit that was already operated in the if else statements above.
						*/
						
						// What do we need to check before deciding to use a 0 or 1?

						/* Explaination:
							We have to check whether the decimal number entered is larger or equal
							to the placeVal, since we only "add a bit" or "change the bit to 1" if the
							decimal number is greater or equal to the current bit's binary place value.
						*/

						if (decNum >= placeVal){
							
							// Do we write a 1 or 0?
							// Explaination: if the decNum is larger or equal to placeVal, we have to change it to 1 as said above.

							bits[i].value = 1;
							/* Explaination: 
								Before the variable b represents a item in the "bits" array, but now we are using a normal for
								loop, so we have to get the bit button by getting it directly from the bits array by the 
								index number i.
							*/
							
							// What do we subtract from the decimal number?
							/* Explaination:
								We have to subtract the placeVal from the decNum since we already added an bit in the binary value,
								and equivalently we have to subtract the current bit's place value from decNum to prevent counting
								this binary bit again in the future.
							*/

							decNum -= placeVal;
						}
						else
							// Do we write a 1 or 0?

							/* Explaination:
								If the decNum is less than placeVal, this means that the decimal value doesn't occupy this current
								binary bit's value. Therefore, we don't only need to write a 0 since we dont need to count this bit
								to represent the decimal value.
							*/

							bits[i].value = 0;
							/* Explaination: 
								Again, the variable b represents a item in the "bits" array, but now we are using a normal for
								loop, so we have to get the bit button by getting it directly from the bits array by the 
								index number i.
							*/
						
						// What happens to the place value of each bit as we go from left -> right?
						/* Explaination:
							The placeVal variable needs to be halved each time we go through a bit, because the binary 
							place value halves as we go through each bit from left to right. For example the
							second bit is 4, and the next bit is 2, so we have to half the placeVal when we go through
							each bit from left to right.
						*/
						
						placeVal /= 2;
					}

					if (decNum != 0) {
						/* Explaination:
							This is the part that determines the precision of the decimal number. This will trigger when the
							converter is not precise enough to convert the decimal number, which means that the decNum will not
							be fully subtracted by the placeVals. Therefore, we need to round if the decNum is not 0.
						*/

						alert("This converter is not precise enough to repesent the decimal number you had entered in binary form!")
						
						if (decNum > 0.0375) {
							/* Explaination:
								0.0375 is 0.5 / 16, which is the half line between 2 precise decimal numbers. If the remaining decNum
								(that is not 0) is greater than 0.0375, we round up the decimal number, but if it is lower than 0.0375,
								we do not need to round it up, we just need to round down.
							*/


							for (let i = bits.length - 1; i >= 0; i --) {
								/* Explaination:
									This is the rounding up functions. To round up, we basically add "1" to the rightmost bit,
									and as it operates the same as binary calculations.

									For exampe 0101 adds 1 to the rightmost bit becomes 0102, and because binary could not display
									2, the two adds a place to the left bit of the 2, which 0102 becomes 0110.
								*/
								if (bits[i].value == 1) {
									bits[i].value = 0;
									continue;
								} else {
									bits[i].value = 1;
									break;
								}
								
							}
						}

						convDec() // Do convDec() again to redisplay the rounded decimal number.
					}
				}
			}
		</script>
	</body>
</html>

<!--
Notes:
1. When creating button ids use btn to start the id.

2. Use this.id to send the id of the button clicked to a function.
We do this so we can change the button clicked to 1 or 0.

3. When dealing with anything other than number inputs, must use .value, not .valueAsNumber.
document.getElementById('btn128').value * 128

4. There actually 10 inputs:
(the 8 bits (buttons) + decimal number input + another button to convert the decimal number).

Therefore we need to have a way to differentiate between them.
The easiest way is to give the table with the 8 bits an id e.g. tblBinary.
Then use this id to get all the buttons in this id and put them in an array (list).

e.g.
let bits = document.getElementById("tblBinary").getElementsByTagName('input');

We can refer to each button with a loop which goes through each button
(the first one is the bit for 128 and the last one the bit for 1).

e.g.
for (let b of bits){
	if (decNum >= placeVal)
		b.value = 1;
	else
		b.value = 0;
	placeVal /= 2;
}


If we didn't do this then we would have to use 8 different ids to refer to each of these 
8 buttons individually.

As the only other input we need to refer to is the decimal number input then we can just refer to by 
giving it its own unique id.

Suggested max % levels:
100% = works as shown here and all 
some attempt to convert in 1 direction
84% = 1 way conversion only.
94% = 2 way conversion but no & HTML JavaScript code restrictions
-->